---
const services = [
  {
    iconType: "iframe",
    iconSrc: "https://lottie.host/embed/d262c03e-3440-4fc2-bb80-53cc348d6f88/ALsJWUYLLr.lottie",
    title: "Sistema de Soporte a la Decisión Clínica",
    description: "Algoritmos Clinicos que asisten y ayudan a los profesionales en la toma de decisiones médicas basadas en datos y estándares clínicos.",
    image: "https://caensaclinicaltrials.com/wp-content/uploads/2020/11/medicina-basada-en-evidencia.jpg",
    features: ["Historiales digitales", "Seguimiento personalizado", "Interfaz intuitiva"],
    color: "primary"
  },
  {
    iconType: "iframe",
    iconSrc: "https://lottie.host/embed/d262c03e-3440-4fc2-bb80-53cc348d6f88/ALsJWUYLLr.lottie",
    title: "Cuestionarios Clinicos",
    description: "Semiautomatizacion de cuestionarios clínicos para agilizar la recopilación de datos y mejorar la precisión en diagnósticos y tratamientos, parametrizadas por sesiones",
    image: "https://www.unitecoprofesional.es/blog/wp-content/uploads/2021/11/machine-learning-medicina-1024x577.jpg",
    features: ["Bartel", "Proceso de anamnesis", "Escalas de dolor (PSFS, GROC, EVA, ENA), Entre otros"],
    color: "primary"
  },
  {
    iconType: "iframe",
    iconSrc: "https://lottie.host/embed/d262c03e-3440-4fc2-bb80-53cc348d6f88/ALsJWUYLLr.lottie",
    title: "Reportes Clínicos",
    description: "Generación automática de informes, estadísticas de progreso y análisis de datos para mejores decisiones.",
    image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=1920&h=1080&fit=crop&crop=center",
    features: ["Informes automáticos", "Estadísticas de progreso", "Análisis de datos"],
    color: "primary"
  },
  {
    iconType: "iframe",
    iconSrc: "https://lottie.host/embed/d262c03e-3440-4fc2-bb80-53cc348d6f88/ALsJWUYLLr.lottie",
    title: "Administración Segura",
    description: "Gestión administrativa completa con facturación, inventarios y controles de acceso de máxima seguridad.",
    image: "https://images.unsplash.com/photo-1542744173-05336fcc7ad4?w=1920&h=1080&fit=crop&crop=center",
    features: ["Facturación integrada", "Control de inventarios", "Máxima seguridad"],
    color: "primary"
  }
];
---

<section id="servicios" class="relative">
  
  <!-- Header Section -->
  <div class="bg-gradient-to-br from-gray-50 to-primary-50 py-16 sm:py-20">
    <div class="container mx-auto px-4 sm:px-6 text-center">
      <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-800 mb-4 sm:mb-6">
        Nuestros <span class="text-primary-600">Servicios</span>
      </h2>
      <p class="text-base sm:text-lg md:text-xl text-gray-600 max-w-2xl sm:max-w-3xl mx-auto leading-relaxed">
        Soluciones integrales diseñadas específicamente para clínicas de kinesiología
      </p>
    </div>
  </div>

  <div class="relative h-[80vh] sm:h-screen overflow-hidden">
    <div class="carousel-container relative h-full">
      <div class="carousel-track flex h-full transition-transform duration-1000 ease-in-out" id="carouselTrack">
        {services.map((service, index) => (
          <div class="carousel-slide min-w-full h-full relative flex items-center justify-center">
            
            <!-- Background Image -->
            <div class="absolute inset-0 z-0">
              <img 
                src={service.image} 
                alt={service.title}
                class="w-full h-full object-cover transform transition-transform duration-[10000ms] ease-out hover:scale-105"
              />
              <!-- Overlay Gradient -->
              <div class={`absolute inset-0 bg-gradient-to-r ${service.color === 'primary' ? 'from-primary-900/70 via-primary-800/60 to-primary-600/50' : 'from-medical-900/70 via-medical-800/60 to-medical-600/50'}`}></div>
              <div class="absolute inset-0 bg-black/20"></div>
            </div>

            <!-- Content Card -->
            <div class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 md:px-10 grid grid-cols-1 lg:grid-cols-2 gap-8 sm:gap-12 items-center h-full">
              
              <!-- Left Content -->
              <div class="text-white space-y-6 sm:space-y-8 animate-slide-up">
                
                <!-- Icon Badge -->
                <div class={`inline-flex p-3 sm:p-4 rounded-2xl ${service.color === 'primary' ? 'bg-primary-500/20' : 'bg-medical-500/20'} backdrop-blur-sm border ${service.color === 'primary' ? 'border-primary-300/30' : 'border-medical-300/30'} shadow-lg`}>
                  <div class={`${service.color === 'primary' ? 'text-primary-300' : 'text-medical-300'}`}>
                    {service.iconType === "iframe" ? (
                      <iframe src={service.iconSrc} width="64" height="64" class="sm:w-20 sm:h-20" frameborder="0"></iframe>
                    ) : (
                      <Fragment set:html={service.icon} />
                    )}
                  </div>
                </div>

                <!-- Title -->
                <div>
                  <h3 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-4 sm:mb-6">
                    {service.title}
                  </h3>
                </div>

                <!-- Description -->
                <p class="text-base sm:text-lg md:text-xl text-gray-200 leading-relaxed max-w-lg">
                  {service.description}
                </p>

                <!-- Features List -->
                <div class="space-y-3 sm:space-y-4">
                  {service.features.map(feature => (
                    <div class="flex items-center space-x-3 sm:space-x-4 text-sm sm:text-base md:text-lg">
                      <div class={`w-2 h-2 rounded-full ${service.color === 'primary' ? 'bg-primary-400' : 'bg-medical-400'}`}></div>
                      <span class="text-gray-100">{feature}</span>
                    </div>
                  ))}
                </div>

                <!-- CTA Button -->
                <div class="pt-3 sm:pt-4">
                  <button class={`group px-6 sm:px-8 py-3 sm:py-4 ${service.color === 'primary' ? 'bg-primary-600 hover:bg-primary-700' : 'bg-medical-600 hover:bg-medical-700'} text-white rounded-full font-semibold text-base sm:text-lg transition-all duration-300 hover:shadow-2xl hover:scale-105`}>
                    <span class="flex items-center">
                      Explorar servicio
                      <svg class="w-4 h-4 sm:w-5 sm:h-5 ml-2 sm:ml-3 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                      </svg>
                    </span>
                  </button>
                </div>
              </div>

              <!-- Right Visual Element (hidden en móviles) -->

            </div>

          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-slide-up {
    animation: slide-up 0.8s ease-out;
  }

  .carousel-slide img {
    will-change: transform;
  }

  .carousel-track {
    will-change: transform;
  }

  /* Mobile optimizations */
  @media (max-width: 640px) {
    .carousel-slide {
      padding: 1.5rem 1rem;
    }
    
    .carousel-slide h3 {
      font-size: 1.75rem; /* ~28px */
    }
    
    .carousel-slide p {
      font-size: 1rem; /* 16px */
    }
  }
</style>



<script>
  let currentSlide = 0;
  let isAutoplay = true;
  let autoplayInterval: string | number | NodeJS.Timeout | undefined;
  const totalSlides = 4;

  function updateCarousel() {
    const track = document.getElementById('carouselTrack');
    const dots = document.querySelectorAll('.progress-dot');
    const slideNum = document.getElementById('currentSlideNum');
    
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    
    // Update progress dots
    dots.forEach((dot, index) => {
      dot.className = `progress-dot h-2 rounded-full transition-all duration-300 ${
        index === currentSlide ? 'bg-white w-12' : 'bg-white/40 w-2 hover:bg-white/60'
      }`;
    });

    // Update slide counter
    slideNum.textContent = String(currentSlide + 1).padStart(2, '0');
  }

  function changeSlide(direction: number) {
    currentSlide += direction;
    
    if (currentSlide >= totalSlides) {
      currentSlide = 0;
    } else if (currentSlide < 0) {
      currentSlide = totalSlides - 1;
    }
    
    updateCarousel();
  }

  function goToSlide(index: number) {
    currentSlide = index;
    updateCarousel();
  }

  function startAutoplay() {
    autoplayInterval = setInterval(() => {
      changeSlide(1);
    }, 6000);
  }

  function stopAutoplay() {
    clearInterval(autoplayInterval);
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    startAutoplay();
    
    // Pause on hover
    const carousel = document.querySelector('.carousel-container');
    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', startAutoplay);

    // Touch support
    let startX = 0;
    let endX = 0;

    carousel.addEventListener('touchstart', (e) => {
      startX = e.changedTouches[0].screenX;
      stopAutoplay();
    });

    carousel.addEventListener('touchend', (e) => {
      endX = e.changedTouches[0].screenX;
      const diff = startX - endX;
      
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          changeSlide(1);
        } else {
          changeSlide(-1);
        }
      }
      
      startAutoplay();
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') changeSlide(-1);
      if (e.key === 'ArrowRight') changeSlide(1);
    });
  });
</script>